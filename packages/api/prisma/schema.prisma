generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["filteredRelationCount"]
}

datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

enum Role {
  ADMIN
  USER

  @@map("Roles")
}

model User {
  id       Int      @id @unique @default(autoincrement())
  created  DateTime @default(now())
  modified DateTime @default(now())
  deleted  Boolean  @default(false)

  username String @unique
  password String
  role     Role

  @@map("Users")
}

model ActivityTemplate {
  id       Int      @id @unique @default(autoincrement())
  created  DateTime @default(now())
  modified DateTime @default(now())
  deleted  Boolean  @default(false)

  description String
  material    String
  cost        Float
  available   Boolean @default(true)

  @@map("ActivityTemplates")
}

model Employee {
  id       Int      @id @unique @default(autoincrement())
  created  DateTime @default(now())
  modified DateTime @default(now())
  deleted  Boolean  @default(false)

  name          String
  position      String
  available     Boolean   @default(true)
  adminProjects Project[] @relation("admin")
  localProjects Project[] @relation("local")

  @@map("Employees")
}

model Project {
  id       Int      @id @unique @default(autoincrement())
  created  DateTime @default(now())
  modified DateTime @default(now())
  deleted  Boolean  @default(false)

  code        String
  description String
  area        String
  start       DateTime
  end         DateTime
  available   Boolean  @default(true)

  areaAdminId  Int?
  areaAdmin    Employee? @relation("admin", fields: [areaAdminId], references: [id])
  localAdminId Int?
  localAdmin   Employee? @relation("local", fields: [localAdminId], references: [id])

  projectActivities ProjectActivity[]
  reports           ProjectReport[]

  @@index([areaAdminId])
  @@index([localAdminId])
  @@map("Projects")
}

model ProjectReport {
  id       Int      @id @unique @default(autoincrement())
  created  DateTime @default(now())
  modified DateTime @default(now())
  deleted  Boolean  @default(false)

  projectId Int?
  project   Project? @relation(fields: [projectId], references: [id])
  date      DateTime

  dailyActivityReports   ActivityReport[] @relation("daily_report")
  monthlyActivityReports ActivityReport[] @relation("monthly_report")

  @@index([projectId])
  @@map("ProjectRepots")
}

model ProjectActivity {
  id       Int      @id @unique @default(autoincrement())
  created  DateTime @default(now())
  modified DateTime @default(now())
  deleted  Boolean  @default(false)

  projectId Int
  project   Project @relation(fields: [projectId], references: [id])

  quantity    Float  @default(0)
  // from activity template
  description String
  material    String
  cost        Float

  dailyActivityReports   ActivityReport[] @relation("daily_activity_report")
  monthlyActivityReports ActivityReport[] @relation("monthly_activity_report")

  @@index([projectId])
  @@map("ProjectActivities")
}

model ActivityReport {
  id       Int      @id @unique @default(autoincrement())
  created  DateTime @default(now())
  modified DateTime @default(now())
  deleted  Boolean  @default(false)

  dailyProjectActivityId   Int?             @map("dailyId")
  dailyProjectActivity     ProjectActivity? @relation("daily_activity_report", fields: [dailyProjectActivityId], references: [id])
  monthlyProjectActivityId Int?             @map("monthlyId")
  monthlyProjectActivity   ProjectActivity? @relation("monthly_activity_report", fields: [monthlyProjectActivityId], references: [id])

  dailyProjectReportId   Int?           @map("dailyReportId")
  dailyProjectReport     ProjectReport? @relation("daily_report", fields: [dailyProjectReportId], references: [id])
  monthlyProjectReportId Int?           @map("monthlyReportId")
  monthlyProjectReport   ProjectReport? @relation("monthly_report", fields: [monthlyProjectReportId], references: [id])

  @@index([monthlyProjectActivityId])
  @@index([dailyProjectActivityId])
  @@index([dailyProjectReportId])
  @@index([monthlyProjectReportId])
  @@map("ActivityReports")
}
